services:
  - type: web
    name: columbiacals-backend
    env: python
    rootDir: ColumbiaCals-Backend
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.8"
      - key: AUTO_REFRESH_ON_START
        value: "false"
      - key: TZ
        value: "America/New_York"
      - key: DATABASE_PATH
        value: "/var/data/ratings.db"
    buildCommand: "pip install -r requirements.txt"
    startCommand: "gunicorn server:app --bind 0.0.0.0:$PORT"
    disk:
      name: ratings-data
      mountPath: /var/data
      sizeGB: 1
  - type: cron
    name: columbiacals-refresh
    env: python
    rootDir: ColumbiaCals-Backend
    schedule: "0 3 * * *"
    buildCommand: "pip install -r requirements.txt"
    command: "python run_all_scrapers.py && python nutrition_api.py"
    envVars:
      - key: PYTHON_VERSION
        value: "3.11.8"
      - key: TZ
        value: "America/New_York"